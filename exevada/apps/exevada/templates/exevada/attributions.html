{% extends 'exevada/base.html' %}
{% load CL_display %}
{% load leaflet_tags %}
{% block extra_header %}
    {% leaflet_js %}
    {% leaflet_css %}
    <style>
        .leaflet-container {  /* all maps */
            width:  1100px;
            height: 400px;
        }
        #specialbigmap {
            height: 400px;
        }
        /* Resize the "display_raw" textbox */
        .django-leaflet-raw-textarea {
            width: 100%;
        }
    </style>
{% endblock %}
{% block navbar_collapse_nav %}
<ul class="navbar-nav mr-auto">
    <li class="nav-item">
        <a class="nav-link" href="/exevada/events">
            Events
            <span class="sr-only">(current)</span>
        </a>
    </li>
    <li class="nav-item active">
        <a class="nav-link" href="#">
            Attribution Studies
            <span class="sr-only">(current)</span>
        </a>
    </li>
    <li class="nav-item dropdown">
        <a class="nav-link catalog-navigation" href="#" id="dropdowndatasets" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
            Datasets
        </a>
        <div class="dropdown-menu" aria-labelledby="dropdowndatasets">
            <a class="dropdown-item" href="/exevada/obsdata">Observation data</a>
            <a class="dropdown-item" href="/exevada/moddata">Model simulations</a>
        </div>
    </li>
    <li class="nav-item">
        <a class="nav-link" href="/admin">
            Admin
            <span class="sr-only">(current)</span>
        </a>
    </li>
</ul>
<form class="form-inline my-2 my-md-0">
    <input class="form-control" type="text" placeholder="Search">
</form>
{% endblock %}
{% block container %}
<h1 class="entry-title">Attribution Studies</h1>
<p>
    <script>
        function map_init_basic (map, options) {
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', maxZoom=2).addTo(map);
            var geometry='{{location_geojson | safe}}';
            var poly=JSON.parse(geometry);
            jsonLayer = L.geoJson(poly,  {
                onEachFeature: function (feature, layer) 
                {
                    layer.bindPopup('<h5>' + feature.properties.name + '</h5>'+'<p>' + feature.properties.description + '</p>');
                }
            }).addTo(map);
            map.fitBounds(jsonLayer.getBounds());
            map.zoomOut(10);
        }
    </script>
    <div>
    {% leaflet_map "yourmap" callback="window.map_init_basic" %}
    </div>
    <div class="pt-5">
    <table id="evttable" class="table">
        <thead class="thead-dark">
            <tr>
              <th scope="col">event</th>
              <th scope="col">attribution study</th>
              <th scope="col">probability ratio</th>
              <th scope="col">intensity change</th>
              <th scope="col">return period [yr]</th>
            </tr>
        </thead>
        {% for attribution in object_list %}
        <tr>
            <td>{{attribution.event.name}}</td>
            <td><a href="/exevada/events/{{attribution.event.pk}}#{{attribution.description}}">{{attribution.description}}</a></td>
            <td>{{attribution.PR}} ({{attribution.PR_min|lower_bnd}}...{{attribution.PR_max|upper_bnd}})</td>
            <td>{{attribution.Delta_I}} ({{attribution.Delta_I_min|lower_bnd}}...{{attribution.Delta_I_max|upper_bnd}})</sub></span></td>
            <td>{{attribution.return_period}}</td>
        </tr>
        {% endfor %}
    </table>
</div>
</p>
{% endblock %}
